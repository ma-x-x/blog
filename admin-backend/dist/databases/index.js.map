{"version":3,"sources":["../../src/databases/index.ts"],"sourcesContent":["import Sequelize from 'sequelize';\nimport { NODE_ENV, DB_HOST, DB_PORT, DB_USER, DB_PASSWORD, DB_DATABASE } from '@config';\nimport UserModel from '@models/users.model';\nimport { logger } from '@utils/logger';\nimport RoleModel from '@/models/roles.model';\nimport MenuModel from '@/models/menus.model';\nimport PermissionModel from '@/models/permissions.model';\nimport DictModel from '@/models/dicts.model';\n\nconst sequelize = new Sequelize.Sequelize(DB_DATABASE, DB_USER, DB_PASSWORD, {\n  dialect: 'mysql',\n  host: DB_HOST,\n  port: Number(DB_PORT),\n  timezone: '+09:00',\n  define: {\n    charset: 'utf8mb4',\n    collate: 'utf8mb4_general_ci',\n    underscored: true,\n    freezeTableName: true,\n  },\n  pool: {\n    min: 0,\n    max: 5,\n  },\n  logQueryParameters: NODE_ENV === 'development',\n  logging: (query, time) => {\n    logger.info(time + 'ms' + ' ' + query);\n  },\n  benchmark: true,\n});\n\nsequelize.authenticate();\n\nconst DB = {\n  Users: UserModel(sequelize),\n  Roles: RoleModel(sequelize),\n  Menus: MenuModel(sequelize),\n  Dicts: DictModel(sequelize),\n  Permissions: PermissionModel(sequelize),\n  sequelize, // connection instance (RAW queries)\n  Sequelize, // library\n};\n\n// 关联关系\n/** 用户-角色--m:n */\nDB.Users.belongsToMany(DB.Roles, { through: 'Users_Roles', as: 'roles', timestamps: false });\nDB.Roles.belongsToMany(DB.Users, { through: 'Users_Roles', as: 'users', timestamps: false });\n\n/** 角色-菜单-- m:n */\nDB.Roles.belongsToMany(DB.Menus, { through: 'Roles_Menus', as: 'menus', timestamps: false });\nDB.Menus.belongsToMany(DB.Roles, { through: 'Roles_Menus', as: 'roles', timestamps: false });\n/** 角色--权限-- m:n */\nDB.Roles.belongsToMany(DB.Permissions, { through: 'Roles_Permissions', as: 'permissions', timestamps: false });\nDB.Permissions.belongsToMany(DB.Roles, { through: 'Roles_Permissions', as: 'roles', timestamps: false });\n\nexport default DB;\n"],"names":["sequelize","Sequelize","DB_DATABASE","DB_USER","DB_PASSWORD","dialect","host","DB_HOST","port","Number","DB_PORT","timezone","define","charset","collate","underscored","freezeTableName","pool","min","max","logQueryParameters","NODE_ENV","logging","query","time","logger","info","benchmark","authenticate","DB","Users","UserModel","Roles","RoleModel","Menus","MenuModel","Dicts","DictModel","Permissions","PermissionModel","belongsToMany","through","as","timestamps"],"mappings":"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"}